<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Amaru Resorts - Luxury Villa Rentals in Spain</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700&family=Montserrat:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Montserrat', sans-serif; }
        .brand-font { font-family: 'Playfair Display', serif; }
        .hero-bg {
            background-image: linear-gradient(rgba(0,0,0,0.4), rgba(0,0,0,0.4)), 
                              url('https://images.unsplash.com/photo-1566073771259-6a8506099945?ixlib=rb-4.0.3&auto=format&fit=crop&w=2070&q=80');
            background-size: cover;
            background-position: center;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Firebase SDK -->
    <script type="module" src="/__/firebase/init.js?useEmulator=true"></script>
    
    <header class="sticky top-0 z-50 bg-white shadow-sm">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center">
                <h1 class="brand-font text-2xl font-bold text-amber-700">Amaru Resorts</h1>
            </div>
            
            <nav class="hidden md:flex space-x-8">
                <a href="#" class="text-gray-700 hover:text-amber-700 font-medium transition" data-lang-key="nav_home">Home</a>
                <a href="#" class="text-gray-700 hover:text-amber-700 font-medium transition" data-lang-key="nav_villas">Villas</a>
                <a href="#" class="text-gray-700 hover:text-amber-700 font-medium transition" data-lang-key="nav_destinations">Destinations</a>
                <a href="#" class="text-gray-700 hover:text-amber-700 font-medium transition" data-lang-key="nav_experiences">Experiences</a>
                <a href="#" class="text-gray-700 hover:text-amber-700 font-medium transition" data-lang-key="nav_about">About</a>
                <a href="#" class="text-gray-700 hover:text-amber-700 font-medium transition" data-lang-key="nav_contact">Contact</a>
            </nav>
            
            <div class="flex items-center space-x-4">
                <div class="relative group" id="language-selector">
                    <button class="flex items-center text-gray-700 hover:text-amber-700 transition">
                        <span class="mr-1" id="current-lang">EN</span>
                        <i class="fas fa-chevron-down text-xs"></i>
                    </button>
                    <div class="absolute right-0 mt-2 w-24 bg-white rounded-md shadow-lg py-1 hidden group-hover:block z-50">
                        <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-amber-50 hover:text-amber-700 language-option" data-lang="en">EN</a>
                        <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-amber-50 hover:text-amber-700 language-option" data-lang="fr">FR</a>
                        <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-amber-50 hover:text-amber-700 language-option" data-lang="es">ES</a>
                        <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-amber-50 hover:text-amber-700 language-option" data-lang="nl">NL</a>
                    </div>
                </div>
                
                <button class="md:hidden text-gray-700">
                    <i class="fas fa-bars text-xl"></i>
                </button>
            </div>
        </div>
    </header>

    <main>
        <!-- Hero Section with Booking Widget -->
        <section class="hero-bg py-16 md:py-24">
            <div class="container mx-auto px-4">
                <div class="max-w-4xl mx-auto text-center text-white mb-12">
                    <h1 class="brand-font text-4xl md:text-5xl font-bold mb-4" data-lang-key="hero_title">
                        Book Direct: 0% Commission & Best Price Guarantee
                    </h1>
                    <p class="text-xl mb-8" data-lang-key="hero_subtitle">
                        Discover luxury villas in Spain's most beautiful destinations
                    </p>
                </div>
                
                <!-- Booking Widget Area -->
                <div class="bg-white rounded-xl shadow-lg p-6 max-w-4xl mx-auto">
                    <div id="avaiBook-widget" class="bg-gray-100 rounded-lg p-8 text-center">
                        <h3 class="text-xl font-semibold text-gray-800 mb-4" data-lang-key="booking_title">Direct Booking Engine</h3>
                        <div class="h-12 bg-amber-100 rounded-lg flex items-center justify-center">
                            <span class="text-amber-800 font-medium" data-lang-key="booking_cta">Search Availability & Book</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Featured Properties Section -->
        <section class="py-16 bg-white">
            <div class="container mx-auto px-4">
                <div class="text-center mb-12">
                    <h2 class="brand-font text-3xl md:text-4xl font-bold text-gray-800 mb-4" data-lang-key="properties_title">
                        Featured Luxury Villas
                    </h2>
                    <p class="text-gray-600 max-w-2xl mx-auto" data-lang-key="properties_subtitle">
                        Experience unparalleled comfort in our handpicked selection of premium properties
                    </p>
                </div>
                
                <!-- Properties Grid (Loaded dynamically) -->
                <div id="properties-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                    <!-- Properties will be loaded here -->
                    <div id="loading-spinner" class="col-span-3 text-center py-12">
                        <i class="fas fa-spinner fa-spin text-3xl text-amber-600 mb-4"></i>
                        <p class="text-gray-600" data-lang-key="loading">Loading properties...</p>
                    </div>
                </div>
                
                <div class="text-center mt-12">
                    <button class="bg-white border-2 border-amber-600 text-amber-600 hover:bg-amber-50 px-6 py-3 rounded-lg font-medium transition" data-lang-key="view_all">
                        View All Properties
                    </button>
                </div>
            </div>
        </section>
    </main>

    <footer class="bg-gray-800 text-white pt-12 pb-6">
        <div class="container mx-auto px-4">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8 mb-8">
                <div>
                    <h3 class="brand-font text-xl font-bold mb-4">Amaru Resorts</h3>
                    <p class="text-gray-300 mb-4" data-lang-key="footer_description">
                        Luxury villa rentals in Spain's most beautiful destinations
                    </p>
                </div>
                
                <div>
                    <h4 class="font-semibold mb-4" data-lang-key="footer_explore">Explore</h4>
                    <ul class="space-y-2">
                        <li><a href="#" class="text-gray-300 hover:text-white transition" data-lang-key="nav_villas">All Villas</a></li>
                        <li><a href="#" class="text-gray-300 hover:text-white transition">Costa del Sol</a></li>
                        <li><a href="#" class="text-gray-300 hover:text-white transition">Ibiza</a></li>
                    </ul>
                </div>
                
                <div>
                    <h4 class="font-semibold mb-4" data-lang-key="footer_support">Support</h4>
                    <ul class="space-y-2">
                        <li><a href="#" class="text-gray-300 hover:text-white transition" data-lang-key="nav_contact">Contact Us</a></li>
                        <li><a href="#" class="text-gray-300 hover:text-white transition">FAQ</a></li>
                    </ul>
                </div>
                
                <div>
                    <h4 class="font-semibold mb-4" data-lang-key="footer_portals">Partner Portals</h4>
                    <ul class="space-y-2">
                        <li><a href="agent_portal.html" class="text-amber-300 hover:text-amber-100 transition">Agent Portal</a></li>
                        <li><a href="admin_portal.html" class="text-amber-300 hover:text-amber-100 transition">Administration Login</a></li>
                    </ul>
                </div>
            </div>
            
            <div class="pt-8 border-t border-gray-700 text-center">
                <p class="text-gray-400 text-sm">
                    &copy; 2025 Amaru Resorts. <span data-lang-key="rights_reserved">All rights reserved.</span>
                </p>
            </div>
        </div>
    </footer>

    <!-- Firebase and Language Script -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
        import { 
            getAuth, 
            signInWithCustomToken,
            onAuthStateChanged 
        } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";
        import { 
            getFirestore, 
            collection, 
            onSnapshot,
            query,
            orderBy
        } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";

        // Initialize Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyChNdjTQq47Z7YLm_ClqA0gOEXTRZj9a6c",
            authDomain: "amaruresorts-public.firebaseapp.com",
            projectId: "amaruresorts-public",
            storageBucket: "amaruresorts-public.appspot.com",
            messagingSenderId: "123456789012",
            appId: "1:123456789012:web:abcdef1234567890abcdef"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Language System
        const translations = {
            'en': {
                'nav_home': 'Home', 'nav_villas': 'Villas', 'nav_destinations': 'Destinations',
                'nav_experiences': 'Experiences', 'nav_about': 'About', 'nav_contact': 'Contact',
                'hero_title': 'Book Direct: 0% Commission & Best Price Guarantee',
                'hero_subtitle': 'Discover luxury villas in Spain\'s most beautiful destinations',
                'booking_title': 'Direct Booking Engine', 'booking_cta': 'Search Availability & Book',
                'properties_title': 'Featured Luxury Villas',
                'properties_subtitle': 'Experience unparalleled comfort in our handpicked selection of premium properties',
                'view_details': 'View Details', 'view_all': 'View All Properties',
                'loading': 'Loading properties...',
                'footer_description': 'Luxury villa rentals in Spain\'s most beautiful destinations',
                'footer_explore': 'Explore', 'footer_support': 'Support',
                'footer_portals': 'Partner Portals', 'rights_reserved': 'All rights reserved.'
            },
            'fr': {
                'nav_home': 'Accueil', 'nav_villas': 'Villas', 'nav_destinations': 'Destinations',
                'nav_experiences': 'Expériences', 'nav_about': 'À propos', 'nav_contact': 'Contact',
                'hero_title': 'Réservez Direct : 0% Commission & Meilleur Prix Garanti',
                'hero_subtitle': 'Découvrez des villas de luxe dans les plus belles destinations d\'Espagne',
                'booking_title': 'Moteur de Réservation Directe', 'booking_cta': 'Rechercher Disponibilité & Réserver',
                'properties_title': 'Villas de Luxe en Vedette',
                'properties_subtitle': 'Vivez un confort incomparable dans notre sélection de propriétés premium',
                'view_details': 'Voir les Détails', 'view_all': 'Voir Toutes les Propriétés',
                'loading': 'Chargement des propriétés...',
                'footer_description': 'Location de villas de luxe dans les plus belles destinations d\'Espagne',
                'footer_explore': 'Explorer', 'footer_support': 'Support',
                'footer_portals': 'Portails Partenaires', 'rights_reserved': 'Tous droits réservés.'
            },
            'es': {
                'nav_home': 'Inicio', 'nav_villas': 'Villas', 'nav_destinations': 'Destinos',
                'nav_experiences': 'Experiencias', 'nav_about': 'Acerca de', 'nav_contact': 'Contacto',
                'hero_title': 'Reserva Directa: 0% Comisión & Garantía del Mejor Precio',
                'hero_subtitle': 'Descubre villas de lujo en los destinos más bellos de España',
                'booking_title': 'Motor de Reserva Directa', 'booking_cta': 'Buscar Disponibilidad & Reservar',
                'properties_title': 'Villas de Lujo Destacadas',
                'properties_subtitle': 'Experimenta un confort inigualable en nuestra selección de propiedades premium',
                'view_details': 'Ver Detalles', 'view_all': 'Ver Todas las Propiedades',
                'loading': 'Cargando propiedades...',
                'footer_description': 'Alquiler de villas de lujo en los destinos más bellos de España',
                'footer_explore': 'Explorar', 'footer_support': 'Soporte',
                'footer_portals': 'Portales para Socios', 'rights_reserved': 'Todos los derechos reservados.'
            },
            'nl': {
                'nav_home': 'Home', 'nav_villas': 'Villa\'s', 'nav_destinations': 'Bestemmingen',
                'nav_experiences': 'Ervaringen', 'nav_about': 'Over', 'nav_contact': 'Contact',
                'hero_title': 'Boek Direct: 0% Commissie & Beste Prijs Garantie',
                'hero_subtitle': 'Ontdek luxe villa\'s in de mooiste bestemmingen van Spanje',
                'booking_title': 'Direct Boekingssysteem', 'booking_cta': 'Zoek Beschikbaarheid & Boek',
                'properties_title': 'Uitgelichte Luxe Villa\'s',
                'properties_subtitle': 'Ervaar ongeëvenaard comfort in onze zorgvuldig geselecteerde premium eigendommen',
                'view_details': 'Bekijk Details', 'view_all': 'Bekijk Alle Eigendommen',
                'loading': 'Eigendommen laden...',
                'footer_description': 'Luxe villaverhuur in de mooiste bestemmingen van Spanje',
                'footer_explore': 'Ontdekken', 'footer_support': 'Ondersteuning',
                'footer_portals': 'Partner Portalen', 'rights_reserved': 'Alle rechten voorbehouden.'
            }
        };

        let currentLang = 'en';

        function changeLanguage(lang) {
            currentLang = lang;
            document.querySelector('#current-lang').textContent = lang.toUpperCase();
            
            document.querySelectorAll('[data-lang-key]').forEach(element => {
                const key = element.getAttribute('data-lang-key');
                if (translations[lang] && translations[lang][key]) {
                    element.textContent = translations[lang][key];
                }
            });
            
            localStorage.setItem('amaru_language', lang);
        }

        // Properties Loading
        function loadProperties() {
            const propertiesContainer = document.getElementById('properties-container');
            const loadingSpinner = document.getElementById('loading-spinner');
            
            const q = query(collection(db, 'public/data/properties'), orderBy('createdAt', 'desc'));
            
            onSnapshot(q, (snapshot) => {
                if (loadingSpinner) loadingSpinner.remove();
                
                propertiesContainer.innerHTML = '';
                
                if (snapshot.empty) {
                    propertiesContainer.innerHTML = `
                        <div class="col-span-3 text-center py-12">
                            <i class="fas fa-home text-3xl text-gray-300 mb-4"></i>
                            <p class="text-gray-600">No properties available at the moment.</p>
                        </div>
                    `;
                    return;
                }
                
                snapshot.forEach((doc) => {
                    const property = doc.data();
                    const propertyCard = createPropertyCard(property);
                    propertiesContainer.appendChild(propertyCard);
                });
            }, (error) => {
                console.error('Error loading properties:', error);
                loadingSpinner.innerHTML = `
                    <i class="fas fa-exclamation-triangle text-3xl text-red-500 mb-4"></i>
                    <p class="text-gray-600">Error loading properties. Please try again later.</p>
                `;
            });
        }

        function createPropertyCard(property) {
            const card = document.createElement('div');
            card.className = 'bg-white rounded-xl shadow-md overflow-hidden transition-transform duration-300 hover:shadow-lg hover:-translate-y-1';
            
            card.innerHTML = `
                <div class="h-56 bg-gray-300 bg-cover bg-center" style="background-image: url('${property.imageUrl || 'https://images.unsplash.com/photo-1613977257363-707ba9348227?ixlib=rb-4.0.3&auto=format&fit=crop&w=1000&q=80'}')">
                </div>
                <div class="p-6">
                    <h3 class="text-xl font-semibold text-gray-800 mb-2">${property.title || 'Luxury Villa'}</h3>
                    <p class="text-gray-600 mb-4 line-clamp-2">${property.description || 'Beautiful property in Spain'}</p>
                    <div class="flex justify-between items-center">
                        <span class="text-amber-700 font-bold">From €${property.pricePerNight || '0'}/night</span>
                        <button class="bg-amber-600 hover:bg-amber-700 text-white px-4 py-2 rounded-lg transition view-details-btn">
                            ${translations[currentLang]?.view_details || 'View Details'}
                        </button>
                    </div>
                </div>
            `;
            
            return card;
        }

        // Authentication
        async function authenticate() {
            try {
                // Try to get custom token from global variable or localStorage
                const token = window.__initial_auth_token || localStorage.getItem('amaru_auth_token');
                
                if (token) {
                    await signInWithCustomToken(auth, token);
                    return true;
                } else {
                    // Fallback to anonymous auth for public access
                    return true;
                }
            } catch (error) {
                console.error('Authentication error:', error);
                return true; // Still load properties even if auth fails
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', async () => {
            // Initialize language
            const savedLang = localStorage.getItem('amaru_language') || 'en';
            changeLanguage(savedLang);
            
            // Set up language selector
            document.querySelectorAll('.language-option').forEach(option => {
                option.addEventListener('click', (e) => {
                    e.preventDefault();
                    const lang = option.getAttribute('data-lang');
                    changeLanguage(lang);
                });
            });
            
            // Authenticate and load properties
            await authenticate();
            loadProperties();
        });
    </script>
</body>
</html>
